VSRCS = $(shell find $(abspath .)/vsrc -name "*.sv" -o -name "*.svh")
LINTSRC = $(shell find $(abspath .)/vsrc -name "*.vlt")
IMG ?=
all:
	# 提交git
	# $(call git_commit, "sim RTL") # DO NOT REMOVE THIS LINE!!!
# 	mkdir -p build
# 	verilator --cc --build -j 0 $^ $(LINTSRC) -Wall --top-module top --Mdir build/obj_dir --trace-fst

WORK_DIR = $(abspath .)
CVCFLAGS ?=
OBJ_DIR = $(NSIM_HOME)/src/verilator/obj_dir

verilator:
	# 提交git
	$(call git_commit, "sim RTL") # DO NOT REMOVE THIS LINE!!!
	@echo "Generating Verilator sources..."
	verilator --cc --build -j 0 -Wall -–assert \
		--top-module top \
		--trace-fst \
		-CFLAGS "$(CVCFLAGS) -I$(NSIM_HOME)/include" \
		--Mdir $(OBJ_DIR) \
		$(VSRCS) $(LINTSRC) \
		`find $(NSIM_HOME)/src/verilator -name "*.cpp" | grep -Ev 'obj_dir' | tr '\n' ' '`

clean:
	rm -rf $(OBJ_DIR)
	rm -rf result

include ../Makefile
include sta.mk
.PHONY: all clean verilator
